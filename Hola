local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- GUI
local screenGui = Instance.new("ScreenGui", game:GetService("CoreGui"))
screenGui.Name = "NehemiasGUI"

local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 220, 0, 100)
frame.Position = UDim2.new(0.5, -110, 0.3, 0)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 25)
title.Position = UDim2.new(0, 0, 0, 0)
title.Text = "Nehem√≠as"
title.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 18

local espBtn = Instance.new("TextButton", frame)
espBtn.Size = UDim2.new(0.8, 0, 0, 30)
espBtn.Position = UDim2.new(0.1, 0, 0, 30)
espBtn.Text = "ESP: OFF"
espBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
espBtn.TextColor3 = Color3.new(1, 1, 1)
espBtn.Font = Enum.Font.SourceSansBold
espBtn.TextSize = 16

local minimizeBtn = Instance.new("TextButton", frame)
minimizeBtn.Size = UDim2.new(0, 25, 0, 25)
minimizeBtn.Position = UDim2.new(1, -30, 0, 0)
minimizeBtn.Text = "-"
minimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
minimizeBtn.TextColor3 = Color3.new(1,1,1)
minimizeBtn.Font = Enum.Font.SourceSansBold
minimizeBtn.TextSize = 16

-- ESP
local espEnabled = false
local allESP = {}

local function removeESP()
	for _, gui in pairs(allESP) do
		gui:Destroy()
	end
	allESP = {}
end

local function createESP(player)
	if player == LocalPlayer then return end

	local function attach()
		if not player.Character or not player.Character:FindFirstChild("Head") then return end

		local billboard = Instance.new("BillboardGui")
		billboard.Name = "NehemiasESP"
		billboard.Size = UDim2.new(0, 100, 0, 20)
		billboard.AlwaysOnTop = true
		billboard.StudsOffset = Vector3.new(0, 3, 0)

		local label = Instance.new("TextLabel", billboard)
		label.Size = UDim2.new(1, 0, 1, 0)
		label.Text = player.Name
		label.BackgroundTransparency = 1
		label.TextColor3 = Color3.new(1, 1, 1)
		label.TextStrokeTransparency = 0.5
		label.TextSize = 14
		label.Font = Enum.Font.SourceSansBold

		billboard.Parent = player.Character.Head
		table.insert(allESP, billboard)

		for _, part in pairs(player.Character:GetDescendants()) do
			if part:IsA("BasePart") then
				part.Material = Enum.Material.Neon
				part.Color = Color3.new(1, 1, 1)
			end
		end
	end

	player.CharacterAdded:Connect(function()
		wait(1)
		if espEnabled then
			attach()
		end
	end)

	if player.Character then
		attach()
	end
end

espBtn.MouseButton1Click:Connect(function()
	espEnabled = not espEnabled
	espBtn.Text = espEnabled and "ESP: ON" or "ESP: OFF"
	espBtn.BackgroundColor3 = espEnabled and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(0, 120, 255)

	if espEnabled then
		for _, plr in pairs(Players:GetPlayers()) do
			createESP(plr)
		end
		Players.PlayerAdded:Connect(createESP)
	else
		removeESP()
	end
end)

-- Minimizar
local minimized = false
minimizeBtn.MouseButton1Click:Connect(function()
	minimized = not minimized
	for _, obj in pairs(frame:GetChildren()) do
		if obj ~= title and obj ~= minimizeBtn then
			obj.Visible = not minimized
		end
	end
	frame.Size = minimized and UDim2.new(0, 220, 0, 25) or UDim2.new(0, 220, 0, 100)
	minimizeBtn.Text = minimized and "+" or "-"
end)
